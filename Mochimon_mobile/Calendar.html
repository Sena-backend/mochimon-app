<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Calendar.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <!-- FullCalendar の CSS と JS をCDNで読み込み -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>


    <title>カレンダー</title>
</head>

<body>
    <div class="header-area">
        <button class="hamburger-button" aria-label="menu">
            <span>
                <i class="fa-solid fa-bars"></i>
            </span>
        </button>

        <h1>Mochimon</h1>

        <a href="../Login.html" class="login-button">
            <span>
                <i class="fa-regular fa-user"></i>
            </span>
        </a>
    </div>

    <nav class="bottom-menu">
        <a href="Home.html" class="menu-button">
            <span>
                <i class="fa-solid fa-house"></i>
            </span>
            <p>ホーム</p>
        </a>
        <a href="#" class="menu-button">
            <span class="select">
                <i class="fa-regular fa-calendar-days"></i>
            </span>
            <p>カレンダー</p>
        </a>
        <a href="Template.html" class="menu-button">
            <span>
                <i class="fa-solid fa-bookmark"></i>
            </span>
            <p>テンプレート</p>
        </a>
        <a href="Shopping.html" class="menu-button">
            <span>
                <i class="fa-solid fa-cart-shopping"></i>
            </span>
            <p>買い物リスト</p>
        </a>
        <a href="Share.html" class="menu-button">
            <span>
                <i class="fa-solid fa-share-nodes"></i>
            </span>
            <p>共有</p>
        </a>
    </nav>
    <div id='calendar'></div>

    <script src="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";
        import { getFirestore, addDoc, updateDoc, deleteDoc, collection } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";

        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyChPt5NDvgd4okxbUQalZtrS7w6Tm30fgg",
            authDomain: "mochimon-base.firebaseapp.com",
            projectId: "mochimon-base",
            storageBucket: "mochimon-base.firebasestorage.app",
            messagingSenderId: "5202457046",
            appId: "1:5202457046:web:7233c6b556a7d260803477",
            measurementId: "G-GPT541EW6S"
        };
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const iconBtn = document.getElementById("user-icon-btn");
        let currentUser = null;
        // ユーザーの認証状態が変わるたびにcurrentUserにセット
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            console.log("auth state changed:", user);
        });
        
        document.addEventListener('DOMContentLoaded', function () {
            const calendarEl = document.getElementById('calendar');
            let selectedDateStr = null;

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,listWeek'
                },
                locale: 'ja',
                events: [
                    {
                        title: '買い物',
                        start: '2025-06-20'
                    },
                    {
                        title: '会議',
                        start: '2025-06-22T14:00:00'
                    }
                ],
                dateClick: function (info) {
                    // 既存の選択クラスを全て削除
                    document.querySelectorAll('.fc-day').forEach(el => {
                        el.classList.remove('selected-date');
                    });

                    // 選択した日付を保存
                    selectedDateStr = info.dateStr;

                    // 選択したセルにクラスを追加して枠を表示
                    info.dayEl.classList.add('selected-date');
                }
            });

            calendar.render();

            document.getElementById("add-event-btn").addEventListener("click", () => {
                // 日付が未選択の場合は今日を使う
                const date = selectedDateStr || new Date().toISOString().split('T')[0];
                window.location.href = `EventCreate.html?date=${date}`;
            });
        });
    </script>

    <!-- プラスボタン -->
    <button id="add-event-btn" class="add-event-btn" aria-label="予定を追加">
        <i class="fa-solid fa-plus"></i>
    </button>

</body>

</html>
